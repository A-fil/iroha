machine:
  services:
    - docker
  environment:
    IROHA_HOME: $(pwd)/iroha
    PATH: $PATH:/opt/cmake-3.5.2-Linux-x86_64/bin
    JAVA_HOME: /usr/lib/jvm/java-1.8.0-openjdk-amd64/
  java:
      version: 'oraclejdk8'

checkout:
  post:
    - git submodule init
    - git submodule update


dependencies:
  cache_directories:
    - ~/iroha/core/vendor/
  override:
    - ${IROHA_HOME}/docker/build.sh

deployment:
  hub:
    branch: master
    commands:
      - docker login -u ${DOCKER_USER} -p ${DOCKER_PASS}
      - docker push hyperledger/iroha-docker

